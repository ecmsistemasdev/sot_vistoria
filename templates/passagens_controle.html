<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Bilhetes - Passagens Aéreas</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    
    <style>
        /* ============================================================================
           SISTEMA DE CONTROLE DE PASSAGENS AÉREAS
           CSS Completo Atualizado com Autocomplete de Aeroportos
           ============================================================================ */
        
        /* Reset básico */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            font-size: 13px;
            padding-top: 20px;
        }
        
        /* Navbar */
        .navbar {
            background-color: #2c3e50;
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
            padding: 8px 0;
        }
        
        .navbar-brand {
            font-size: 14px;
            font-weight: 600;
            color: white !important;
        }
        
        .navbar-nav .nav-link {
            font-size: 13px;
            color: white !important;
            padding: 8px 15px;
        }
        
        .navbar-nav .nav-link:hover {
            background-color: rgba(255,255,255,0.1);
            border-radius: 3px;
        }
        
        /* Content Wrapper */
        .content-wrapper {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Page Header */
        .page-header {
            background-color: #2c3e50;
            color: white;
            padding: 10px 20px;
            margin-bottom: 15px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-header h2 {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
            letter-spacing: 0.5px;
        }
        
        .page-header p {
            font-size: 12px;
            margin: 0;
            opacity: 0.9;
        }
        
        /* Cards */
        .card {
            border: none;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,.1);
            margin-bottom: 20px;
            background-color: white;
        }
        
        .card-header {
            background-color: #2c3e50;
            color: white;
            border-radius: 4px 4px 0 0 !important;
            padding: 10px 15px;
        }
        
        .card-header h5 {
            font-size: 14px;
            font-weight: 600;
            margin: 0;
        }
        
        .card-body {
            padding: 15px;
        }
        
        /* Botões */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn i {
            margin-right: 5px;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            color: white;
        }
        
        .btn-success {
            background-color: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #229954;
            color: white;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
            color: white;
        }
        
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
            color: white;
        }
        
        .btn-info {
            background-color: #16a085;
            color: white;
        }
        
        .btn-info:hover {
            background-color: #138d75;
            color: white;
        }
        
        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #7f8c8d;
            color: white;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        /* Tabelas */
        .table {
            font-size: 12px;
            margin-bottom: 0;
        }
        
        .table thead th {
            background-color: #ecf0f1;
            border-bottom: 2px solid #bdc3c7;
            font-weight: 600;
            color: #2c3e50;
            font-size: 12px;
            padding: 10px;
            vertical-align: middle;
        }
        
        .table tbody td {
            padding: 8px 10px;
            vertical-align: middle;
        }
        
        /* Modais */
        .modal-header {
            background-color: #2c3e50;
            color: white;
            padding: 12px 20px;
        }
        
        .modal-header .modal-title {
            font-size: 14px;
            font-weight: 600;
        }
        
        .modal-header .close {
            color: white;
            opacity: 1;
            font-size: 24px;
            font-weight: 300;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            font-size: 12px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            display: block;
        }
        
        .form-control {
            font-size: 13px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 3px;
            transition: border-color 0.2s;
        }
        
        .form-control:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }
        
        .form-control:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }
        
        /* Badges */
        .badge {
            padding: 5px 10px;
            font-size: 11px;
            font-weight: 600;
            border-radius: 3px;
        }
        
        .badge-info {
            background-color: #3498db;
            color: white;
        }
        
        .badge-success {
            background-color: #27ae60;
            color: white;
        }
        
        .badge-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .badge-danger {
            background-color: #e74c3c;
            color: white;
        }
        
        /* ============================================================================
           ESTILOS DO AUTOCOMPLETE DE AEROPORTOS
           ============================================================================ */
        
        .aeroporto-autocomplete {
            position: relative;
        }
        
        .aeroporto-autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
            border-radius: 0 0 4px 4px;
        }
        
        .aeroporto-autocomplete-list.show {
            display: block;
        }
        
        .aeroporto-autocomplete-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .aeroporto-autocomplete-item:hover {
            background-color: #f8f9fa;
        }
        
        .aeroporto-autocomplete-item:last-child {
            border-bottom: none;
        }
        
        .aeroporto-codigo {
            font-weight: bold;
            color: #0066cc;
            margin-right: 8px;
            font-size: 13px;
            min-width: 40px;
        }
        
        .aeroporto-local {
            color: #666;
            font-size: 13px;
            flex: 1;
        }
        
        .aeroporto-pais {
            font-size: 0.85em;
            color: #999;
            margin-left: 5px;
        }
        
        .autocomplete-loading {
            padding: 10px 15px;
            text-align: center;
            color: #999;
            font-style: italic;
            font-size: 12px;
        }
        
        /* Estilo para input com autocomplete ativo */
        .aeroporto-autocomplete .form-control:focus {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .aeroporto-autocomplete .form-control:focus + input + .aeroporto-autocomplete-list.show {
            border-top: 1px solid #3498db;
        }
        
        /* ============================================================================
           RESPONSIVIDADE
           ============================================================================ */
        
        @media (max-width: 768px) {
            .content-wrapper {
                padding: 10px;
            }
        
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        
            .table {
                font-size: 11px;
            }
        
            .btn {
                padding: 6px 12px;
                font-size: 12px;
            }
        
            .btn-sm {
                padding: 4px 8px;
                font-size: 11px;
            }
        
            .action-buttons {
                flex-direction: column;
                gap: 3px;
            }
        
            .aeroporto-autocomplete-list {
                max-height: 200px;
            }
        
            .aeroporto-codigo {
                font-size: 12px;
                min-width: 35px;
            }
        
            .aeroporto-local {
                font-size: 12px;
            }
        }
        
        /* ============================================================================
           UTILIDADES
           ============================================================================ */
        
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .text-muted {
            color: #95a5a6;
        }
        
        .mt-3 {
            margin-top: 1rem;
        }
        
        .mb-3 {
            margin-bottom: 1rem;
        }
        
        .p-3 {
            padding: 1rem;
        }
        
        /* ScrollBar customizado */
        .aeroporto-autocomplete-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .aeroporto-autocomplete-list::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .aeroporto-autocomplete-list::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        .aeroporto-autocomplete-list::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* ============================================================================
           ANIMAÇÕES
           ============================================================================ */
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .aeroporto-autocomplete-list.show {
            animation: fadeIn 0.2s ease-out;
        }
        
        /* Highlight ao selecionar */
        .aeroporto-autocomplete-item:active {
            background-color: #e8f4f8;
        }
        
        /* ============================================================================
           IMPRESSÃO
           ============================================================================ */
        
        @media print {
            .navbar,
            .btn,
            .action-buttons,
            .aeroporto-autocomplete-list {
                display: none !important;
            }
        
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        
            .table {
                font-size: 10px;
            }
        }        
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/controle_passagens_aereas">
                <i class="fas fa-plane"></i> Passagens Aéreas
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/controle_passagens_aereas">
                            <i class="fas fa-arrow-left"></i> Voltar ao Orçamento
                        </a>
                    </li>
                    <li class="nav-item">
                        <span class="nav-link">
                            <i class="fas fa-user"></i> {{ usuario }}
                        </span>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/logout">
                            <i class="fas fa-sign-out-alt"></i> Sair
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <div class="container-fluid content-wrapper">
        <!-- Cabeçalho -->
        <div class="page-header">
            <div>
                <h2><i class="fas fa-ticket-alt"></i> Controle de Bilhetes Emitidos</h2>
                <p>Gerencie os bilhetes de passagens aéreas emitidas</p>
            </div>
        </div>

        <!-- Botões de Ação -->
        <div class="row mb-3">
            <div class="col-md-12">
                <button class="btn btn-primary" data-toggle="modal" data-target="#modalCadastro">
                    <i class="fas fa-plus"></i> Nova Passagem
                </button>
                <button class="btn btn-info" data-toggle="modal" data-target="#modalFiltros">
                    <i class="fas fa-filter"></i> Filtros
                </button>
                <button class="btn btn-success" onclick="limparFiltros()">
                    <i class="fas fa-sync"></i> Limpar Filtros
                </button>
            </div>
        </div>

        <!-- Card com a Tabela -->
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-list"></i> Bilhetes Emitidos</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="tabelaPassagens" class="table table-striped table-bordered table-hover" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Passageiro</th>
                                        <th>CIA</th>
                                        <th>Localizador</th>
                                        <th>Rota</th>
                                        <th>Emissão</th>
                                        <th>Embarque</th>
                                        <th>Valor Total</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for p in passagens %}
                                    <tr>
                                        <td>{{ p[0] }}</td>
                                        <td>{{ p[4] }}</td>
                                        <td><span class="badge badge-info">{{ p[10] }}</span></td>
                                        <td>{{ p[11] }}</td>
                                        <td><strong>{{ p[6] }}</strong></td>
                                        <td>{{ p[5] }}</td>
                                        <td>{{ p[9] }}</td>
                                        <td>R$ {{ p[16] }}</td>
                                        <td>
                                            <div class="action-buttons">
                                                <button class="btn btn-sm btn-warning" onclick="editarPassagem({{ p[0] }})" title="Editar">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-sm btn-danger" onclick="confirmarExclusao({{ p[0] }})" title="Excluir">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cadastro -->
    <div class="modal fade" id="modalCadastro" tabindex="-1">
        <div class="modal-dialog modal-form">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-plus"></i> Nova Passagem</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formCadastro" onsubmit="salvarPassagem(event)">
                        <input type="hidden" id="id_opa" name="id_opa">
                        <input type="hidden" name="id_controle" value="0">

                        <div class="info-box">
                            <i class="fas fa-info-circle"></i>
                            <strong>Atenção:</strong> Campos com <span style="color: #e74c3c;">*</span> são obrigatórios.
                        </div>

                        <!-- Unidade/Programa/Empenho -->
                        <div class="form-group">
                            <label class="required">Unidade/Programa/Empenho</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="orcamento_display" readonly placeholder="Clique em buscar para selecionar" required>
                                <div class="input-group-append">
                                    <button type="button" class="btn btn-info" onclick="abrirSeletorOrcamento()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Nº SEI -->
                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <label>Nº SEI</label>
                                    <input type="text" class="form-control sei-mask" id="nu_sei" name="nu_sei" placeholder="0000000-00.0000.0.00.0000">
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <label class="required">Data Emissão</label>
                                    <input type="date" class="form-control" id="dt_emissao" name="dt_emissao" required>
                                </div>
                            </div>
                        </div>

                        <!-- Nome do Passageiro -->
                        <div class="form-group">
                            <label class="required">Nome do Passageiro</label>
                            <input type="text" class="form-control" id="nome_passageiro" name="nome_passageiro" maxlength="100" required>
                        </div>

                        <!-- Origem, Destino, Rota -->
                        <div class="row">
                            <!-- EXEMPLO: Campo de Origem com Autocomplete -->
                            <div class="form-group aeroporto-autocomplete">
                                <label for="origem">Origem *</label>
                                <input 
                                    type="text" 
                                    class="form-control" 
                                    id="origem" 
                                    name="origem"
                                    placeholder="Digite código (ex: PVH) ou cidade (ex: Porto Velho)"
                                    required
                                    autocomplete="off">
                                <input type="hidden" id="codigo_origem" name="codigo_origem">
                                <div class="aeroporto-autocomplete-list" id="origem-list"></div>
                            </div>
                            
                            <!-- EXEMPLO: Campo de Destino com Autocomplete -->
                            <div class="form-group aeroporto-autocomplete">
                                <label for="destino">Destino *</label>
                                <input 
                                    type="text" 
                                    class="form-control" 
                                    id="destino" 
                                    name="destino"
                                    placeholder="Digite código (ex: GRU) ou cidade (ex: São Paulo)"
                                    required
                                    autocomplete="off">
                                <input type="hidden" id="codigo_destino" name="codigo_destino">
                                <div class="aeroporto-autocomplete-list" id="destino-list"></div>
                            </div>

                            <div class="col-4">
                                <div class="form-group">
                                    <label class="required">Rota</label>
                                    <input type="text" class="form-control" id="rota" name="rota" style="text-transform: uppercase;" required>
                                </div>
                            </div>
                        </div>

                        <!-- Data Embarque, CIA, Localizador -->
                        <div class="row">
                            <div class="col-4">
                                <div class="form-group">
                                    <label class="required">Data Embarque</label>
                                    <input type="date" class="form-control" id="dt_embarque" name="dt_embarque" required>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group">
                                    <label class="required">Cia Aérea</label>
                                    <input type="text" class="form-control" id="cia" name="cia" maxlength="10" style="text-transform: uppercase;" required>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group">
                                    <label>Localizador</label>
                                    <input type="text" class="form-control" id="localizador" name="localizador" maxlength="10" style="text-transform: uppercase;">
                                </div>
                            </div>
                        </div>

                        <hr>
                        <h6 style="font-size: 13px; margin-bottom: 10px;"><i class="fas fa-dollar-sign"></i> Valores</h6>

                        <!-- Valores -->
                        <div class="row">
                            <div class="col-3">
                                <div class="form-group">
                                    <label class="required">Tarifa</label>
                                    <input type="text" class="form-control form-control-sm money-mask" id="vl_tarifa" name="vl_tarifa" value="0,00" required>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label>Taxa Extra</label>
                                    <input type="text" class="form-control form-control-sm money-mask" id="vl_taxa_extra" name="vl_taxa_extra" value="0,00">
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label>Assento</label>
                                    <input type="text" class="form-control form-control-sm money-mask" id="vl_assento" name="vl_assento" value="0,00">
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label>Taxa Embarque</label>
                                    <input type="text" class="form-control form-control-sm money-mask" id="vl_taxa_embarque" name="vl_taxa_embarque" value="0,00">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Valor Total</label>
                            <input type="hidden" id="vl_total" name="vl_total" value="0,00">
                            <div class="valor-total" id="vl_total_display">R$ 0,00</div>
                        </div>

                        <div class="text-right mt-3">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Salvar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Seletor de Orçamento -->
    <div class="modal fade" id="modalSeletorOrcamento" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-search"></i> Selecionar Orçamento</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table id="tabelaOrcamentos" class="table table-striped table-bordered table-hover table-sm" style="width:100%; font-size: 11px;">
                            <thead>
                                <tr>
                                    <th>UO</th>
                                    <th>Unidade</th>
                                    <th>Programa</th>
                                    <th>Subitem</th>
                                    <th>Aprovado</th>
                                    <th>Utilizado</th>
                                    <th>Saldo</th>
                                    <th>Empenho</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tbodyOrcamentos">
                                <!-- Será preenchido via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Edição -->
    <div class="modal fade" id="modalEdicao" tabindex="-1">
        <div class="modal-dialog modal-form">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-edit"></i> Editar Passagem</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formEdicao" onsubmit="atualizarPassagem(event)">
                        <input type="hidden" id="id_of_edit" name="id_of_edit">
                        <input type="hidden" id="id_opa_edit" name="id_opa_edit">
                        <input type="hidden" name="id_controle_edit" value="0">

                        <div class="info-box">
                            <i class="fas fa-info-circle"></i>
                            <strong>Atenção:</strong> Campos com <span style="color: #e74c3c;">*</span> são obrigatórios.
                        </div>

                        <!-- Unidade/Programa/Empenho (somente leitura na edição) -->
                        <div class="form-group">
                            <label>Unidade/Programa/Empenho</label>
                            <input type="text" class="form-control" id="orcamento_display_edit" readonly>
                        </div>

                        <!-- Nº SEI -->
                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <label>Nº SEI</label>
                                    <input type="text" class="form-control sei-mask" id="nu_sei_edit" name="nu_sei_edit" placeholder="0000000-00.0000.0.00.0000">
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <label class="required">Data Emissão</label>
                                    <input type="date" class="form-control" id="dt_emissao_edit" name="dt_emissao_edit" required>
                                </div>
                            </div>
                        </div>

                        <!-- Nome do Passageiro -->
                        <div class="form-group">
                            <label class="required">Nome do Passageiro</label>
                            <input type="text" class="form-control" id="nome_passageiro_edit" name="nome_passageiro_edit" maxlength="100" required>
                        </div>

                        <!-- Rota, Origem, Destino -->
                        <div class="row">
                            <div class="col-4">
                                <div class="form-group">
                                    <label class="required">Rota</label>
                                    <input type="text" class="form-control" id="rota_edit" name="rota_edit" style="text-transform: uppercase;" required>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group">
                                    <label class="required">Origem</label>
                                    <input type="text" class="form-control" id="origem_edit" name="origem_edit" style="text-transform: uppercase;" required>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group">
                                    <label class="required">Destino</label>
                                    <input type="text" class="form-control" id="destino_edit" name="destino_edit" style="text-transform: uppercase;" required>
                                </div>
                            </div>
                        </div>

                        <!-- Data Embarque, CIA, Localizador -->
                        <div class="row">
                            <div class="col-4">
                                <div class="form-group">
                                    <label class="required">Data Embarque</label>
                                    <input type="date" class="form-control" id="dt_embarque_edit" name="dt_embarque_edit" required>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group">
                                    <label class="required">Cia Aérea</label>
                                    <input type="text" class="form-control" id="cia_edit" name="cia_edit" maxlength="10" style="text-transform: uppercase;" required>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-group">
                                    <label>Localizador</label>
                                    <input type="text" class="form-control" id="localizador_edit" name="localizador_edit" maxlength="10" style="text-transform: uppercase;">
                                </div>
                            </div>
                        </div>

                        <hr>
                        <h6 style="font-size: 13px; margin-bottom: 10px;"><i class="fas fa-dollar-sign"></i> Valores</h6>

                        <!-- Valores -->
                        <div class="row">
                            <div class="col-3">
                                <div class="form-group">
                                    <label class="required">Tarifa</label>
                                    <input type="text" class="form-control form-control-sm money-mask" id="vl_tarifa_edit" name="vl_tarifa_edit" value="0,00" required>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label>Taxa Extra</label>
                                    <input type="text" class="form-control form-control-sm money-mask" id="vl_taxa_extra_edit" name="vl_taxa_extra_edit" value="0,00">
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label>Assento</label>
                                    <input type="text" class="form-control form-control-sm money-mask" id="vl_assento_edit" name="vl_assento_edit" value="0,00">
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="form-group">
                                    <label>Taxa Embarque</label>
                                    <input type="text" class="form-control form-control-sm money-mask" id="vl_taxa_embarque_edit" name="vl_taxa_embarque_edit" value="0,00">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Valor Total</label>
                            <input type="hidden" id="vl_total_edit" name="vl_total_edit" value="0,00">
                            <div class="valor-total" id="vl_total_display_edit">R$ 0,00</div>
                        </div>

                        <div class="text-right mt-3">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Atualizar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Filtros -->
    <div class="modal fade" id="modalFiltros" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-filter"></i> Filtros</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formFiltros" onsubmit="aplicarFiltros(event)">
                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <label>Data Início</label>
                                    <input type="date" class="form-control" id="dt_inicio_filtro" name="dt_inicio_filtro">
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <label>Data Fim</label>
                                    <input type="date" class="form-control" id="dt_fim_filtro" name="dt_fim_filtro">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-6">
                                <div class="form-group">
                                    <label>Companhia Aérea</label>
                                    <select class="form-control" id="cia_filtro" name="cia_filtro">
                                        <option value="">Todas</option>
                                        {% for cia in cias %}
                                        <option value="{{ cia[0] }}">{{ cia[0] }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <label>Passageiro</label>
                                    <input type="text" class="form-control" id="passageiro_filtro" name="passageiro_filtro" placeholder="Nome do passageiro">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Localizador</label>
                            <input type="text" class="form-control" id="localizador_filtro" name="localizador_filtro" placeholder="Código do localizador">
                        </div>

                        <div class="text-right mt-3">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search"></i> Aplicar Filtros
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

    <script>
        // ============================================================================
        // SISTEMA DE CONTROLE DE PASSAGENS AÉREAS
        // JavaScript Completo Atualizado
        // ============================================================================
        
        // ============================================================================
        // CLASSE: AeroportoAutocomplete
        // Implementa busca e seleção de aeroportos com autocomplete
        // ============================================================================
        class AeroportoAutocomplete {
            constructor(inputId, hiddenCodeId, listId) {
                this.input = document.getElementById(inputId);
                this.hiddenCode = document.getElementById(hiddenCodeId);
                this.list = document.getElementById(listId);
                this.timeout = null;
                this.minChars = 2;
                this.debounceTime = 300;
                
                this.init();
            }
            
            init() {
                // Evento de digitação
                this.input.addEventListener('input', (e) => {
                    clearTimeout(this.timeout);
                    const termo = e.target.value.trim();
                    
                    if (termo.length < this.minChars) {
                        this.hideList();
                        return;
                    }
                    
                    // Debounce para evitar muitas requisições
                    this.timeout = setTimeout(() => {
                        this.buscar(termo);
                    }, this.debounceTime);
                });
                
                // Evento de foco - reabrir lista se já tiver valor
                this.input.addEventListener('focus', () => {
                    const termo = this.input.value.trim();
                    if (termo.length >= this.minChars && this.list.children.length > 0) {
                        this.list.classList.add('show');
                    }
                });
                
                // Fechar lista ao clicar fora
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.aeroporto-autocomplete')) {
                        this.hideList();
                    }
                });
                
                // Limpar código oculto quando input é limpo manualmente
                this.input.addEventListener('change', () => {
                    if (!this.input.value.trim()) {
                        this.hiddenCode.value = '';
                    }
                });
            }
            
            async buscar(termo) {
                try {
                    this.showLoading();
                    
                    const response = await fetch(`/api/aeroportos/buscar?termo=${encodeURIComponent(termo)}`);
                    const data = await response.json();
                    
                    if (data.success && data.aeroportos.length > 0) {
                        this.renderList(data.aeroportos);
                    } else {
                        this.showEmpty();
                    }
                } catch (error) {
                    console.error('Erro ao buscar aeroportos:', error);
                    this.showError();
                }
            }
            
            renderList(aeroportos) {
                this.list.innerHTML = '';
                
                aeroportos.forEach(aero => {
                    const item = document.createElement('div');
                    item.className = 'aeroporto-autocomplete-item';
                    item.innerHTML = `
                        <span class="aeroporto-codigo">${aero.codigo_iata}</span>
                        <span class="aeroporto-local">${aero.cidade}${aero.uf ? '/' + aero.uf : ''}</span>
                        <span class="aeroporto-pais">(${aero.pais})</span>
                    `;
                    
                    item.addEventListener('click', () => {
                        this.selecionar(aero);
                    });
                    
                    this.list.appendChild(item);
                });
                
                this.list.classList.add('show');
            }
            
            selecionar(aeroporto) {
                // Preencher campo visível
                const uf = aeroporto.uf ? `/${aeroporto.uf}` : '';
                this.input.value = `${aeroporto.codigo_iata} - ${aeroporto.cidade}${uf}`;
                
                // Preencher campo oculto com código IATA
                this.hiddenCode.value = aeroporto.codigo_iata;
                
                this.hideList();
                
                // Disparar evento personalizado para outros scripts que possam precisar
                const event = new CustomEvent('aeroporto-selecionado', {
                    detail: aeroporto
                });
                this.input.dispatchEvent(event);
            }
            
            showLoading() {
                this.list.innerHTML = '<div class="autocomplete-loading">Buscando aeroportos...</div>';
                this.list.classList.add('show');
            }
            
            showEmpty() {
                this.list.innerHTML = '<div class="autocomplete-loading">Nenhum aeroporto encontrado</div>';
                this.list.classList.add('show');
            }
            
            showError() {
                this.list.innerHTML = '<div class="autocomplete-loading" style="color: #dc3545;">Erro ao buscar aeroportos</div>';
                this.list.classList.add('show');
            }
            
            hideList() {
                this.list.classList.remove('show');
            }
        }
        
        // ============================================================================
        // INICIALIZAÇÃO QUANDO O DOCUMENTO ESTIVER PRONTO
        // ============================================================================
        $(document).ready(function() {
            // Inicializar DataTable
            $('#tabelaPassagens').DataTable({
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.21/i18n/Portuguese-Brasil.json"
                },
                "pageLength": 25,
                "order": [[0, "desc"]],
                "columnDefs": [
                    { "orderable": false, "targets": -1 }
                ]
            });
        
            // Máscaras de input
            aplicarMascaras();
        
            // Listeners de cálculo automático
            $('#vl_tarifa, #vl_taxa_extra, #vl_assento, #vl_taxa_embarque').on('input', calcularTotal);
            $('#vl_tarifa_edit, #vl_taxa_extra_edit, #vl_assento_edit, #vl_taxa_embarque_edit').on('input', calcularTotalEdit);
        
            // Carregar orçamentos no modal de cadastro
            $('#modalCadastro').on('show.bs.modal', function() {
                carregarOrcamentos('id_opa');
            });
        
            // Carregar orçamentos no modal de edição
            $('#modalEdicao').on('show.bs.modal', function() {
                carregarOrcamentos('id_opa_edit');
            });
        
            // Inicializar autocompletes de aeroportos
            inicializarAutocompletes();
        });
        
        // ============================================================================
        // INICIALIZAÇÃO DOS AUTOCOMPLETES DE AEROPORTOS
        // ============================================================================
        function inicializarAutocompletes() {
            // Autocomplete para ORIGEM (modal de cadastro)
            if (document.getElementById('origem')) {
                window.autocompleteOrigem = new AeroportoAutocomplete(
                    'origem',
                    'codigo_origem',
                    'origem-list'
                );
            }
            
            // Autocomplete para DESTINO (modal de cadastro)
            if (document.getElementById('destino')) {
                window.autocompleteDestino = new AeroportoAutocomplete(
                    'destino',
                    'codigo_destino',
                    'destino-list'
                );
            }
            
            // Autocomplete para ORIGEM (modal de edição)
            if (document.getElementById('origem_edit')) {
                window.autocompleteOrigemEdit = new AeroportoAutocomplete(
                    'origem_edit',
                    'codigo_origem_edit',
                    'origem-list-edit'
                );
            }
            
            // Autocomplete para DESTINO (modal de edição)
            if (document.getElementById('destino_edit')) {
                window.autocompleteDestinoEdit = new AeroportoAutocomplete(
                    'destino_edit',
                    'codigo_destino_edit',
                    'destino-list-edit'
                );
            }
        }
        
        // ============================================================================
        // CARREGAR ORÇAMENTOS DISPONÍVEIS
        // ============================================================================
        function carregarOrcamentos(selectId) {
            $.ajax({
                url: '/api/orcamento/passagens/disponiveis',
                type: 'GET',
                success: function(response) {
                    if (response.success) {
                        var select = $('#' + selectId);
                        select.empty();
                        select.append('<option value="">Selecione...</option>');
                        
                        response.registros.forEach(function(orc) {
                            var saldo = parseFloat(orc.saldo).toFixed(2);
                            var label = `ID ${orc.id_opa} - ${orc.unidade} - ${orc.programa} - Saldo: R$ ${saldo}`;
                            select.append(`<option value="${orc.id_opa}">${label}</option>`);
                        });
                    }
                },
                error: function(xhr) {
                    console.error('Erro ao carregar orçamentos:', xhr);
                    alert('Erro ao carregar orçamentos disponíveis');
                }
            });
        }
        
        // ============================================================================
        // MÁSCARAS DE INPUT
        // ============================================================================
        function aplicarMascaras() {
            // Máscara de moeda
            $('.money').mask('#.##0,00', {reverse: true});
            
            // Listeners para calcular total automaticamente
            $('.money').on('blur', function() {
                var id = $(this).attr('id');
                if (id.includes('_edit')) {
                    calcularTotalEdit();
                } else {
                    calcularTotal();
                }
            });
        }
        
        // ============================================================================
        // CALCULAR VALOR TOTAL (CADASTRO)
        // ============================================================================
        function calcularTotal() {
            var tarifa = parseFloat($('#vl_tarifa').val().replace(/\./g, '').replace(',', '.')) || 0;
            var taxaExtra = parseFloat($('#vl_taxa_extra').val().replace(/\./g, '').replace(',', '.')) || 0;
            var assento = parseFloat($('#vl_assento').val().replace(/\./g, '').replace(',', '.')) || 0;
            var taxaEmbarque = parseFloat($('#vl_taxa_embarque').val().replace(/\./g, '').replace(',', '.')) || 0;
            
            var total = tarifa + taxaExtra + assento + taxaEmbarque;
            
            $('#vl_total').val(total.toFixed(2).replace('.', ','));
            $('#vl_total_display').text('R$ ' + total.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}));
        }
        
        // ============================================================================
        // CALCULAR VALOR TOTAL (EDIÇÃO)
        // ============================================================================
        function calcularTotalEdit() {
            var tarifa = parseFloat($('#vl_tarifa_edit').val().replace(/\./g, '').replace(',', '.')) || 0;
            var taxaExtra = parseFloat($('#vl_taxa_extra_edit').val().replace(/\./g, '').replace(',', '.')) || 0;
            var assento = parseFloat($('#vl_assento_edit').val().replace(/\./g, '').replace(',', '.')) || 0;
            var taxaEmbarque = parseFloat($('#vl_taxa_embarque_edit').val().replace(/\./g, '').replace(',', '.')) || 0;
            
            var total = tarifa + taxaExtra + assento + taxaEmbarque;
            
            $('#vl_total_edit').val(total.toFixed(2).replace('.', ','));
            $('#vl_total_display_edit').text('R$ ' + total.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}));
        }
        
        // ============================================================================
        // SALVAR NOVA PASSAGEM
        // ============================================================================
        function salvarPassagem(event) {
            event.preventDefault();
            
            // Validar orçamento selecionado
            if (!$('#id_opa').val()) {
                alert('Por favor, selecione um orçamento (Unidade/Programa/Empenho)');
                return;
            }
            
            // Validar aeroportos selecionados
            if (!$('#codigo_origem').val()) {
                alert('Por favor, selecione um aeroporto de origem válido');
                return;
            }
            
            if (!$('#codigo_destino').val()) {
                alert('Por favor, selecione um aeroporto de destino válido');
                return;
            }
            
            $.ajax({
                url: '/passagens/salvar',
                type: 'POST',
                data: $('#formCadastro').serialize(),
                success: function(response) {
                    if (response.success) {
                        alert('Passagem cadastrada com sucesso!');
                        location.reload();
                    } else {
                        alert('Erro: ' + response.message);
                    }
                },
                error: function(xhr) {
                    alert('Erro ao salvar: ' + (xhr.responseJSON ? xhr.responseJSON.message : 'Erro desconhecido'));
                }
            });
        }
        
        // ============================================================================
        // BUSCAR DADOS PARA EDIÇÃO (CORRIGIDO)
        // ============================================================================
        function editarPassagem(id) {
            $.ajax({
                url: '/api/passagens/obter/' + id,
                type: 'GET',
                success: function(response) {
                    if (response.success) {
                        var p = response.passagem;
                        
                        // Preencher campos básicos
                        $('#id_of_edit').val(p.id_of);
                        $('#id_opa_edit').val(p.id_opa || '');
                        $('#nu_sei_edit').val(p.nu_sei || '');
                        $('#nome_passageiro_edit').val(p.nome_passageiro || '');
                        $('#dt_emissao_edit').val(p.dt_emissao || '');
                        $('#rota_edit').val(p.rota || '');
                        $('#dt_embarque_edit').val(p.dt_embarque || '');
                        $('#cia_edit').val(p.cia || '');
                        $('#localizador_edit').val(p.localizador || '');
                        
                        // Preencher origem com autocomplete
                        if (p.origem_display) {
                            $('#origem_edit').val(p.origem_display);
                        } else if (p.origem) {
                            $('#origem_edit').val(p.origem);
                        }
                        $('#codigo_origem_edit').val(p.codigo_origem || '');
                        
                        // Preencher destino com autocomplete
                        if (p.destino_display) {
                            $('#destino_edit').val(p.destino_display);
                        } else if (p.destino) {
                            $('#destino_edit').val(p.destino);
                        }
                        $('#codigo_destino_edit').val(p.codigo_destino || '');
                        
                        // Preencher valores financeiros
                        $('#vl_tarifa_edit').val(formatarMoeda(p.vl_tarifa));
                        $('#vl_taxa_extra_edit').val(formatarMoeda(p.vl_taxa_extra));
                        $('#vl_assento_edit').val(formatarMoeda(p.vl_assento));
                        $('#vl_taxa_embarque_edit').val(formatarMoeda(p.vl_taxa_embarque));
                        $('#vl_total_edit').val(formatarMoeda(p.vl_total));
                        
                        // Calcular e exibir total
                        calcularTotalEdit();
                        
                        // Abrir modal
                        $('#modalEdicao').modal('show');
                    } else {
                        alert('Erro ao buscar dados: ' + (response.message || 'Erro desconhecido'));
                    }
                },
                error: function(xhr) {
                    console.error('Erro completo:', xhr);
                    alert('Erro ao buscar dados: ' + (xhr.responseJSON ? xhr.responseJSON.message : 'Erro desconhecido'));
                }
            });
        }
        
        // ============================================================================
        // ATUALIZAR PASSAGEM
        // ============================================================================
        function atualizarPassagem(event) {
            event.preventDefault();
            
            // Validar aeroportos selecionados
            if (!$('#codigo_origem_edit').val()) {
                alert('Por favor, selecione um aeroporto de origem válido');
                return;
            }
            
            if (!$('#codigo_destino_edit').val()) {
                alert('Por favor, selecione um aeroporto de destino válido');
                return;
            }
            
            $.ajax({
                url: '/passagens/atualizar',
                type: 'POST',
                data: $('#formEdicao').serialize(),
                success: function(response) {
                    if (response.success) {
                        alert('Passagem atualizada com sucesso!');
                        location.reload();
                    } else {
                        alert('Erro: ' + response.message);
                    }
                },
                error: function(xhr) {
                    alert('Erro ao atualizar: ' + (xhr.responseJSON ? xhr.responseJSON.message : 'Erro desconhecido'));
                }
            });
        }
        
        // ============================================================================
        // CONFIRMAR EXCLUSÃO
        // ============================================================================
        function confirmarExclusao(id) {
            if (confirm('Tem certeza que deseja excluir esta passagem?')) {
                $.ajax({
                    url: '/passagens/excluir/' + id,
                    type: 'POST',
                    success: function(response) {
                        if (response.success) {
                            alert('Passagem excluída com sucesso!');
                            location.reload();
                        } else {
                            alert('Erro: ' + response.message);
                        }
                    },
                    error: function(xhr) {
                        alert('Erro ao excluir: ' + (xhr.responseJSON ? xhr.responseJSON.message : 'Erro desconhecido'));
                    }
                });
            }
        }
        
        // ============================================================================
        // APLICAR FILTROS
        // ============================================================================
        function aplicarFiltros(event) {
            event.preventDefault();
            
            // Converter datas para formato dd/mm/yyyy
            var dtInicio = $('#dt_inicio_filtro').val();
            var dtFim = $('#dt_fim_filtro').val();
            
            var formData = new FormData($('#formFiltros')[0]);
            
            if (dtInicio) {
                var partes = dtInicio.split('-');
                formData.set('dt_inicio_filtro', partes[2] + '/' + partes[1] + '/' + partes[0]);
            }
            
            if (dtFim) {
                var partes = dtFim.split('-');
                formData.set('dt_fim_filtro', partes[2] + '/' + partes[1] + '/' + partes[0]);
            }
            
            $.ajax({
                url: '/passagens/filtrar',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        var table = $('#tabelaPassagens').DataTable();
                        table.clear();
                        
                        response.data.forEach(function(passagem) {
                            // passagem[0] = ID_OF
                            // passagem[4] = NOME_PASSAGEIRO
                            // passagem[9] = ORIGEM_FORMATADA
                            // passagem[10] = DESTINO_FORMATADO
                            // passagem[6] = ROTA
                            // passagem[5] = DT_EMISSAO_F
                            // passagem[13] = DT_EMBARQUE_F
                            // passagem[18] = VL_TOTAL_F
                            
                            table.row.add([
                                passagem[0],
                                passagem[4],
                                '<span class="badge badge-info">' + (passagem[9] || '-') + '</span>',
                                '<span class="badge badge-success">' + (passagem[10] || '-') + '</span>',
                                '<strong>' + (passagem[6] || '-') + '</strong>',
                                passagem[5],
                                passagem[13],
                                'R$ ' + passagem[18],
                                '<div class="action-buttons">' +
                                '<button class="btn btn-sm btn-warning" onclick="editarPassagem(' + passagem[0] + ')" title="Editar"><i class="fas fa-edit"></i></button> ' +
                                '<button class="btn btn-sm btn-danger" onclick="confirmarExclusao(' + passagem[0] + ')" title="Excluir"><i class="fas fa-trash"></i></button>' +
                                '</div>'
                            ]);
                        });
                        
                        table.draw();
                        $('#modalFiltros').modal('hide');
                    } else {
                        alert('Erro: ' + response.message);
                    }
                },
                error: function(xhr) {
                    alert('Erro ao filtrar: ' + (xhr.responseJSON ? xhr.responseJSON.message : 'Erro desconhecido'));
                }
            });
        }
        
        // ============================================================================
        // LIMPAR FILTROS
        // ============================================================================
        function limparFiltros() {
            location.reload();
        }
        
        // ============================================================================
        // LIMPAR FORMULÁRIO DE CADASTRO
        // ============================================================================
        function limparFormularioCadastro() {
            document.getElementById('formCadastro').reset();
            $('#codigo_origem').val('');
            $('#codigo_destino').val('');
            $('#vl_total').val('0,00');
            $('#vl_total_display').text('R$ 0,00');
        }
        
        // ============================================================================
        // FUNÇÃO AUXILIAR: FORMATAR VALOR COMO MOEDA
        // ============================================================================
        function formatarMoeda(valor) {
            if (!valor) return '0,00';
            return parseFloat(valor).toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }
        
        // ============================================================================
        // FUNÇÃO AUXILIAR: CONVERTER DATA PARA FORMATO BRASILEIRO
        // ============================================================================
        function formatarDataBR(data) {
            if (!data) return '';
            var partes = data.split('-');
            return partes[2] + '/' + partes[1] + '/' + partes[0];
        }
        
        // ============================================================================
        // FUNÇÃO AUXILIAR: CONVERTER DATA PARA FORMATO ISO
        // ============================================================================
        function formatarDataISO(data) {
            if (!data) return '';
            var partes = data.split('/');
            return partes[2] + '-' + partes[1] + '-' + partes[0];
        }
    </script>
</body>
</html>
