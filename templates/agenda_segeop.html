    async function copiarComoImagem() {
        const conteudo = document.getElementById('conteudoVisualizacao');
        
        // Verificar se html2canvas está disponível
        if (typeof html2canvas === 'undefined') {
            mostrarAlerta(
                'Para usar este recurso, é necessário incluir a biblioteca html2canvas.<br><br>' +
                'Por enquanto, você pode usar a tecla Print Screen para capturar a tela.',
                'ℹ️ Informação',
                '#1a73e8'
            );
            return;
        }
        
        // ===== VERIFICAR PERMISSÃO DA CLIPBOARD API =====
        try {
            const permissionStatus = await navigator.permissions.query({ name: 'clipboard-write' });
            
            if (permissionStatus.state === 'denied') {
                mostrarAlerta(
                    '❌ <strong>Permissão Negada</strong><br><br>' +
                    'Seu navegador bloqueou o acesso à área de transferência.<br><br>' +
                    '<strong>Solução:</strong><br>' +
                    '1. Clique no ícone de <strong>cadeado/informação</strong> na barra de endereço<br>' +
                    '2. Permita o acesso à <strong>Área de transferência</strong><br>' +
                    '3. Recarregue a página e tente novamente<br><br>' +
                    '<em>Ou use Print Screen manualmente.</em>',
                    '⚠️ Acesso Bloqueado',
                    '#dc3545'
                );
                return;
            }
        } catch (permError) {
            console.warn('Não foi possível verificar permissão da clipboard:', permError);
            // Continuar mesmo assim (alguns navegadores não suportam permissions query)
        }
        
        try {
            mostrarSpinner();
            
            // Encontrar a tabela dentro do conteúdo
            const tabela = conteudo.querySelector('table');
            const tituloSecao = conteudo.querySelector('.section-title-compacto');
            
            if (!tabela) {
                esconderSpinner();
                mostrarAlerta('Nenhuma tabela encontrada para capturar!', '⚠️ Aviso', '#ffc107');
                return;
            }
            
            // Criar container temporário
            const containerTemp = document.createElement('div');
            
            containerTemp.style.cssText = `
                background: white; 
                padding: 10px; 
                box-sizing: border-box;
                position: absolute;
                left: -9999px;
                top: 0;
            `;
            
            if (tituloSecao) {
                const tituloClone = tituloSecao.cloneNode(true);
                containerTemp.appendChild(tituloClone);
            }
            
            const tabelaClone = tabela.cloneNode(true);
            
            // Aplicar estilos na tabela
            tabelaClone.style.cssText = `
                width: 100%;
                border-collapse: collapse;
                border: 1px solid #bbb;
                border-width: 1px;
                table-layout: auto;
                font-size: 11px;
            `;
            
            // Fixar colunas N. e Nome no cabeçalho
            const thsClonados = tabelaClone.querySelectorAll('thead th');
            thsClonados.forEach((th, index) => {
                const styleBase = `
                    background: #e8e8e8;
                    padding: 4px 2px;
                    text-align: center;
                    border: 1px solid #bbb;
                    border-width: 1px;
                    font-size: 10px;
                    font-weight: 600;
                    line-height: 1.2;
                `;
                
                if (index === 0) {
                    th.style.cssText = styleBase + `
                        width: 28px;
                        min-width: 28px;
                        max-width: 28px;
                    `;
                } else if (index === 1) {
                    th.style.cssText = styleBase + `
                        width: 140px;
                        min-width: 140px;
                        max-width: 140px;
                    `;
                } else {
                    th.style.cssText = styleBase + `
                        padding: 4px 8px;
                        white-space: normal;
                        word-wrap: break-word;
                    `;
                }
            });
            
            // Aplicar estilos em células do tbody mantendo cores
            const tdsClonados = tabelaClone.querySelectorAll('tbody td');
            tdsClonados.forEach((td) => {
                const classes = td.className;
                const computedStyle = window.getComputedStyle(td);
                const bgColor = computedStyle.backgroundColor;
                
                if (classes.includes('col-numero')) {
                    td.style.cssText = `
                        background: ${bgColor};
                        border: 1px solid #bbb;
                        border-width: 1px;
                        padding: 2px 1px;
                        vertical-align: top;
                        font-size: 9px;
                        line-height: 1.2;
                        min-height: 18px;
                        font-weight: 600;
                        text-align: center;
                        width: 28px;
                        min-width: 28px;
                        max-width: 28px;
                    `;
                } else if (classes.includes('col-nome')) {
                    td.style.cssText = `
                        background: ${bgColor};
                        border: 1px solid #bbb;
                        border-width: 1px;
                        padding: 2px 4px;
                        vertical-align: top;
                        font-size: 9px;
                        line-height: 1.2;
                        min-height: 18px;
                        font-weight: 600;
                        word-wrap: break-word;
                        white-space: normal;
                        width: 140px;
                        min-width: 140px;
                        max-width: 140px;
                    `;
                } else {
                    td.style.cssText = `
                        background: ${bgColor};
                        border: 1px solid #bbb;
                        border-width: 1px;
                        padding: 2px 8px;
                        vertical-align: top;
                        font-size: 9px;
                        line-height: 1.3;
                        min-height: 18px;
                        white-space: normal;
                        word-wrap: break-word;
                    `;
                }
            });
            
            containerTemp.appendChild(tabelaClone);
            document.body.appendChild(containerTemp);
            
            // Aguardar renderização completa
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // Capturar com html2canvas
            const canvas = await html2canvas(containerTemp, {
                backgroundColor: '#ffffff',
                scale: 3,
                logging: false,
                useCORS: true,
                allowTaint: true,
                imageTimeout: 0
            });
            
            // Remover container temporário
            document.body.removeChild(containerTemp);
            
            // ===== TENTAR COPIAR PARA CLIPBOARD =====
            canvas.toBlob(async (blob) => {
                try {
                    // Tentar usando Clipboard API moderna
                    await navigator.clipboard.write([
                        new ClipboardItem({ 'image/png': blob })
                    ]);
                    
                    esconderSpinner();
                    
                    mostrarAlerta(
                        '✅ <strong>Imagem copiada com sucesso!</strong><br><br>' +
                        'Cole (Ctrl+V) no aplicativo desejado (Word, Excel, etc.)',
                        '✅ Sucesso',
                        '#28a745'
                    );
                    
                } catch (clipboardError) {
                    esconderSpinner();
                    
                    console.error('Erro ao copiar para clipboard:', clipboardError);
                    
                    // ===== FALLBACK: DOWNLOAD AUTOMÁTICO =====
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `agenda_${new Date().getTime()}.png`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    mostrarAlerta(
                        '⚠️ <strong>Não foi possível copiar automaticamente</strong><br><br>' +
                        '✅ A imagem foi <strong>baixada automaticamente</strong><br><br>' +
                        '<strong>Motivo:</strong> Seu navegador bloqueou o acesso à área de transferência.<br><br>' +
                        '<strong>Solução alternativa:</strong><br>' +
                        '1. Localize o arquivo PNG baixado<br>' +
                        '2. Abra a imagem<br>' +
                        '3. Copie manualmente (Ctrl+C) e cole onde desejar<br><br>' +
                        '<em>Ou permita o acesso à área de transferência nas configurações do navegador.</em>',
                        'ℹ️ Download Realizado',
                        '#1a73e8'
                    );
                }
            }, 'image/png');
            
        } catch (error) {
            esconderSpinner();
            console.error('Erro geral ao gerar imagem:', error);
            
            mostrarAlerta(
                '❌ <strong>Erro ao processar imagem</strong><br><br>' +
                `<strong>Detalhes:</strong> ${error.message}<br><br>` +
                '<strong>Tente:</strong><br>' +
                '1. Recarregar a página (F5)<br>' +
                '2. Usar outro navegador (Chrome recomendado)<br>' +
                '3. Usar Print Screen manualmente',
                '⚠️ Erro',
                '#dc3545'
            );
        }
    }
